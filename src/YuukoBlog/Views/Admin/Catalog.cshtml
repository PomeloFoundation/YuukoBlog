@model IEnumerable<Catalog>
@{
    ViewBag.Title = "Admin Panel";
}

<div class="blog-post" id="admin-catalogs">
    <table class="blog-table">
        <thead>
            <tr>
                <th>URL</th>
                <th>Title</th>
                <th>Icon</th>
                <th>Priority</th>
                <th colspan="2">Control</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="catalog in catalogs">
                <td><input type="text" class="form-control" v-model="catalog.url" /></td>
                <td><input type="text" class="form-control" v-model="catalog.title" /></td>
                <td><input type="text" class="form-control" v-model="catalog.icon" /></td>
                <td><input type="text" class="form-control" v-model="catalog.priority" /></td>
                <td><input type="button" class="btn btn-primary" v-on:click="update(catalog)" value="Save" /></td>
                <td><input type="button" class="btn btn-danger" v-on:click="delete(catalog.url)" value="Delete" /></td>
            </tr>
            <tr>
                <td><input type="text" class="form-control" v-model="add.url" /></td>
                <td><input type="text" class="form-control" v-model="add.title" /></td>
                <td><input type="text" class="form-control" v-model="add.icon" /></td>
                <td><input type="text" class="form-control" v-model="add.priority" /></td>
                <td><input type="button" class="btn btn-primary" v-on:click="create" value="Add" /></td>
                <td><input type="button" class="btn btn-info" v-on:click="reset" value="Reset" /></td>
            </tr>
        </tbody>
    </table>
</div>

<script src="~/scripts/vue.js"></script>
<script>var app = new Vue({
    el: '#admin-catalogs',
    data: {
        catalogs: [],
        add: {
            url: null,
            title: null,
            icon: null,
            priority: 999
        }
    },
    methods: {
        loadCatalogs: function () {
            var self = this;
            jQuery.get('/admin/catalog/all', {}, function (data) {
                self.catalogs = data;
            });
        },
        delete: function (id) {
            if (confirm("Are you sure you want to delete this catalog?")) {
                jQuery.post('/admin/catalog/delete', { id: id }, function () {
                    this.loadCatalogs();
                })
            }
        },
        reset: function () {
            this.add = {
                url: null,
                title: null,
                icon: null,
                priority: 999
            };
        },
        create: function () {
            var self = this;
            jQuery.post('/admin/catalog/new', this.add, function () {
                self.loadCatalogs();
                self.reset();
            });
        },
        update: function (catalog) {
            var self = this;
            jQuery.post('/admin/catalog/edit', catalog, function () {
                self.loadCatalogs();
            });
        }
    },
    created: function () {
        this.loadCatalogs();
    }
})
</script>