@model IEnumerable<BlogRoll>
@{
    ViewBag.Title = "Admin Panel";
}

<div class="blog-post" id="admin-rolls">
    <table class="blog-table">
        <thead>
            <tr>
                <th>Display</th>
                <th>URL</th>
                <th>Priority</th>
                <th colspan="2">Control</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="roll in rolls">
                <td><input type="text" class="form-control" v-model="roll.display" /></td>
                <td><input type="text" class="form-control" v-model="roll.url" /></td>
                <td><input type="text" class="form-control" v-model="roll.priority" /></td>
                <td><input type="button" class="btn btn-primary" v-on:click="update(roll)" value="Save" /></td>
                <td><input type="button" class="btn btn-danger" v-on:click="remove(roll.id)" value="Delete" /></td>
            </tr>
            <tr>
                <td><input type="text" class="form-control" v-model="add.display" /></td>
                <td><input type="text" class="form-control" v-model="add.url" /></td>
                <td><input type="text" class="form-control" v-model="add.priority" /></td>
                <td><input type="button" class="btn btn-primary" v-on:click="create" value="Add" /></td>
                <td><input type="button" class="btn btn-info" v-on:click="reset" value="Reset" /></td>
            </tr>
        </tbody>
    </table>
</div>

<script src="~/scripts/vue.js"></script>
<script>var app = new Vue({
    el: '#admin-rolls',
    data: {
        rolls: [],
        add: {
            url: null,
            display: null,
            priority: 999
        }
    },
    methods: {
        loadRolls: function () {
            var self = this;
            jQuery.get('/admin/blogroll/all', {}, function (data) {
                self.rolls = data;
            });
        },
        remove: function (id) {
            var self = this;
            if (confirm('Are you sure you want to delete this blog roll?')) {
                jQuery.post('/admin/blogroll/delete', { id: id }, function () {
                    self.loadRolls();
                })
            }
        },
        reset: function () {
            this.add = {
                url: null,
                display: null,
                icon: null,
                priority: 999
            };
        },
        create: function () {
            var self = this;
            jQuery.post('/admin/blogroll/new', this.add, function () {
                self.loadRolls();
                self.reset();
            });
        },
        update: function (catalog) {
            var self = this;
            jQuery.post('/admin/blogroll/edit', catalog, function () {
                self.loadRolls();
            });
        }
    },
    created: function () {
        this.loadRolls();
    }
})</script>