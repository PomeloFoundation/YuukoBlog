@model IEnumerable<Catalog>
@{
    ViewBag.Title = "Admin Panel";
}

<div class="blog-post" id="admin-links">
    <table class="blog-table">
        <thead>
            <tr>
                <th>Display</th>
                <th>URL</th>
                <th>Icon</th>
                <th>Priority</th>
                <th colspan="2">Control</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="link in links">
                <td><input type="text" class="form-control" v-model="link.display" /></td>
                <td><input type="text" class="form-control" v-model="link.url" /></td>
                <td><input type="text" class="form-control" v-model="link.icon" /></td>
                <td><input type="text" class="form-control" v-model="link.priority" /></td>
                <td><input type="button" class="btn btn-primary" v-on:click="update(link)" value="Save" /></td>
                <td><input type="button" class="btn btn-danger" v-on:click="remove(link.id)" value="Delete" /></td>
            </tr>
            <tr>
                <td><input type="text" class="form-control" v-model="add.display" /></td>
                <td><input type="text" class="form-control" v-model="add.url" /></td>
                <td><input type="text" class="form-control" v-model="add.icon" /></td>
                <td><input type="text" class="form-control" v-model="add.priority" /></td>
                <td><input type="button" class="btn btn-primary" v-on:click="create" value="Add" /></td>
                <td><input type="button" class="btn btn-info" v-on:click="reset" value="Reset" /></td>
            </tr>
        </tbody>
    </table>
</div>

<script src="~/scripts/vue.js"></script>
<script>var app = new Vue({
    el: '#admin-links',
    data: {
        links: [],
        add: {
            url: null,
            display: null,
            icon: null,
            priority: 999
        }
    },
    methods: {
        loadLinks: function () {
            var self = this;
            jQuery.get('/admin/link/all', {}, function (data) {
                self.links = data;
            });
        },
        remove: function (id) {
            var self = this;
            if (confirm('Are you sure you want to delete this link?')) {
                jQuery.post('/admin/link/delete', { id: id }, function () {
                    self.loadLinks();
                })
            }
        },
        reset: function () {
            this.add = {
                url: null,
                display: null,
                icon: null,
                priority: 999
            };
        },
        create: function () {
            var self = this;
            jQuery.post('/admin/link/new', this.add, function () {
                self.loadLinks();
                self.reset();
            });
        },
        update: function (catalog) {
            var self = this;
            jQuery.post('/admin/link/edit', catalog, function () {
                self.loadLinks();
            });
        }
    },
    created: function () {
        this.loadLinks();
    }
})</script>